% MATLAB script generated by bash script

% Configure local parallel cluster
pc = parallel.cluster.Local;
job_folder = fullfile('/home1/jongminm/.matlab/local_cluster_jobs/R2022a', getenv('SLURM_JOB_ID'));
if ~exist(job_folder, 'dir')
    mkdir(job_folder);
end
set(pc, 'JobStorageLocation', job_folder);

% Determine number of cores for parallel pool
ncores = str2num(getenv('SLURM_CPUS_PER_TASK')) - 1;
pool = parpool(pc, ncores);

 
db_dir = '/home1/jongminm/sparse_kmeans/sparse_kmeans.db';

% Add sparse_kmeans path
addpath(genpath('/home1/jongminm/sparse_kmeans'));

% Define the file paths
file_x = "colon_x.txt";
file_y = "colon_y.txt";

% Read the data from the text files
% readmatrix is generally good for plain numerical data files
try
    colon_x = readmatrix(file_x);
    colon_x = normalize(colon_x,2);
     disp(['Successfully loaded: ' file_x]);
    disp(['Size of colon_x: ' num2str(size(colon_x))]);
catch ME
    warning(['Error loading ' file_x ': ' ME.message]);
end

try
    colon_y = readmatrix(file_y);
    colon_y= colon_y'+1
    disp(['Successfully loaded: ' file_y]);
    disp(['Size of colon_y: ' num2str(size(colon_y))]);
catch ME
    warning(['Error loading ' file_y ': ' ME.message]);
end
 

%  

% Run ISEE_kmeans_clean_simul
model = 'chain45'
ISEE_kmeans_clean_simul(colon_x, 2, 200, true, 10, 5, 0.01, db_dir, 'real', 0, 'colon', 0, colon_y);

% Delete parallel pool
delete(pool);
