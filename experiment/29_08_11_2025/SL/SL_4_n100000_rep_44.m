% MATLAB script generated by SLURM job generator

% Add necessary paths for sparse_kmeans functions
addpath(genpath('/home1/jongminm/sparse_kmeans'));

% --- Database Configuration ---
table_name = 'SL';
db_dir = '/home1/jongminm/sparse_kmeans/sparse_kmeans.db';

% --- Simulation Parameters ---
% These values are passed from the shell script
model = 'iso';
cluster_1_ratio = 0.5;
sep = 4; % Separation parameter
n = 100000;     % Number of samples
p = 10000;     % Number of features/dimensions (current loop variable)
rep = 44; % Repetition number (current loop variable)
delta = 0;
fprintf('--- Starting MATLAB simulation for p=%d, rep=%d ---\n', p, rep);

% --- Data Generation ---
generator = data_generator_approximately_sparse_mean(n, p, 10, sep, rep, 0.5)
[data, label_true] = generator.get_data(1, delta);
 

% --- Run sdp_kmeans_bandit_even_simul ---
clusterer = sdp_kmeans_iter_knowncov_SL_NMF(data, 2);
cluster_est=clusterer.fit_predict(30);
acc = get_bicluster_accuracy(cluster_est, label_true);
time = clusterer.time;
table = get_database_subtable(rep, sep, 1:10,  clusterer,  acc, time);

% --- Insert Results into SQLite Database ---
% Insert the results from the bandit simulation into the specified SQLite table
% The '1:10' is assumed to be a placeholder for a specific range or set of values.
insertTableIntoSQLite(db_dir, table_name, table, rep, sep, 1:10);

fprintf('--- Finished MATLAB simulation for p=%d, rep=%d ---\n', p, rep);

% Exit MATLAB cleanly after script execution
exit;
