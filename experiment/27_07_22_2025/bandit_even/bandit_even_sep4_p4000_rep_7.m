% MATLAB script generated by SLURM job generator

% Add necessary paths for sparse_kmeans functions
addpath(genpath('/home1/jongminm/sparse_kmeans'));

% --- Database Configuration ---
table_name = 'bandit_even';
db_dir = '/home1/jongminm/sparse_kmeans/sparse_kmeans.db';

% --- Simulation Parameters ---
% These values are passed from the shell script
model = 'iso';
cluster_1_ratio = 0.5;
sep = 4; % Separation parameter
n = 200;     % Number of samples
p = 4000;     % Number of features/dimensions (current loop variable)
rep = 7; % Repetition number (current loop variable)

fprintf('--- Starting MATLAB simulation for p=%d, rep=%d ---\n', p, rep);

% --- Data Generation ---
% Generate Gaussian data based on specified parameters
[data, label_true, mu1, mu2, generated_sep, ~, beta_star] = generate_gaussian_data(n, p, 10, sep, 'iso', 'equal_symmetric', 0, rep, cluster_1_ratio, rep);
% Transpose data and labels to match expected format (e.g., rows as samples)
data = data';
label_true = label_true';


% --- Run sdp_kmeans_bandit_even_simul ---
% Initialize and run the bandit k-means simulation
bandit = sdp_kmeans_bandit_even_simul(data, 2);
bandit.fit_predict(2, label_true);

% --- Insert Results into SQLite Database ---
% Insert the results from the bandit simulation into the specified SQLite table
% The '1:10' is assumed to be a placeholder for a specific range or set of values.
insertTableIntoSQLite(db_dir, table_name, bandit, rep, sep, 1:10);

fprintf('--- Finished MATLAB simulation for p=%d, rep=%d ---\n', p, rep);

% Exit MATLAB cleanly after script execution
exit;
